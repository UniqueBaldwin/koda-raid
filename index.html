<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Koda Dashboard | Nuke System</title>
    <style>
        body { background: #121212; color: white; font-family: 'Inter', sans-serif; margin: 0; }
        .hero { height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; background: radial-gradient(circle, #5865f244 0%, #121212 100%); }
        .btn-discord { background: #5865F2; padding: 15px 30px; border-radius: 8px; color: white; text-decoration: none; font-weight: bold; font-size: 20px; transition: 0.3s; }
        .btn-discord:hover { background: #4752c4; transform: scale(1.05); }
        .dashboard { padding: 40px; display: none; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .card { background: #1e1e1e; padding: 20px; border-radius: 12px; text-align: center; border: 1px solid #333; }
        .card img { width: 80px; height: 80px; border-radius: 50%; margin-bottom: 10px; border: 2px solid #5865F2; }
        .btn-raid { background: #ff4757; border: none; color: white; padding: 10px; width: 100%; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-raid:hover { background: #c0392b; }
    </style>
</head>
<body>

    <div id="home" class="hero">
        <h1 style="font-size: 60px; margin-bottom: 10px;">KODA <span style="color: #5865F2;">RAID</span></h1>
        <p style="color: #aaa; margin-bottom: 30px;">El panel de control definitivo para pruebas de estrés.</p>
        <a href="https://koda-raid.onrender.com/login" class="btn-discord">Entrar con Discord</a>
        <br>
        <a href="https://discord.com/oauth2/authorize?client_id=1469577414022795346" style="color: #5865F2; text-decoration: none;">+ Invitar Bot al servidor</a>
    </div>

    <div id="dash" class="dashboard">
        <h2>Servidores Disponibles</h2>
        <p>Solo aparecen servidores donde eres Admin y el Bot está presente.</p>
        <div id="serverList" class="grid"></div>
    </div>

    <script>
        const token = new URLSearchParams(window.location.search).get('token');
        if(token) {
            document.getElementById('home').style.display = 'none';
            document.getElementById('dash').style.display = 'block';
            loadServers();
        }

        async function loadServers() {
            const res = await fetch('https://koda-raid.onrender.com/api/servers', {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const guilds = await res.json();
            const list = document.getElementById('serverList');
            
            guilds.forEach(g => {
                const icon = g.icon ? `https://cdn.discordapp.com/icons/${g.id}/${g.icon}.png` : 'https://i.imgur.com/vHqQWId.png';
                list.innerHTML += `
                    <div class="card">
                        <img src="${icon}">
                        <h3>${g.name}</h3>
                        <button class="btn-raid" onclick="nuke('${g.id}')">INICIAR RAID</button>
                    </div>
                `;
            });
        }

        async function nuke(id) {
            if(confirm("¿Seguro que quieres raidear?")) {
                await fetch(`https://koda-raid.onrender.com/nuke?guildId=${id}`);
                alert("¡Orden enviada!");
            }
        }
    </script>
</body>
</html>